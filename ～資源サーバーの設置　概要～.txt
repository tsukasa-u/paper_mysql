～資源サーバーの設置　概要～

ー背景ー
　サバイバルモードで得られる資源にも限りがある。資源を求めてワールドの地形を生成しすぎるとワールドが重くなってしまう。
	ー＞別のワールドを生成して定期的にリセットする。（ホロ鯖、にじ鯖のようなサーバー構成を作りたい）

ー環境ー
	Linux　（Ubuntu　20.04）
	Server　Parper			https://papermc.io/downloads/paper
	ProxyServer　Velocity		https://papermc.io/downloads/velocity

手順1（新規ワールド作成時）(paper)
新規フォルダを作成し、paper-*.jarをこのフォルダに移動。
以下のコマンドをpaper-*.jarがあるディレクトリで実行。
java -jar paper-*.jar nogui
いったんプログラムが終了するのでeura.txtの設定をして、再び同じコマンドを実行。

初期ファイル構成
-+ServerExamle
 |-paper-*.jar


手順1（バニラからの引継ぎ）
新規フォルダを作成し、paper-*.jarをこのフォルダに移動。
banillaのワールドデータをバックアップし、paper-*.jarとworldフォルダを同じディレクトリに配置する。
--（新規ワールド作成時）と同じーー
以下のコマンドをpaper-*.jarがあるディレクトリで実行。
java -jar paper-*.jar nogui
いったんプログラムが終了するのでeura.txtの設定をして、再び同じコマンドを実行。

初期ファイル構成
-ServerExamle
  |-paper-*.jar
  |-world
    |-...
    |-...
    
    
手順２（server.propertiesの設定)
server.propertiesを開き、online-mode=trueをonline-mode=falseに変更する。
解放ポートが確定している場合、server-portを設定する。このポート番号はjarファイル起動時にコマンドラインで設定することが可能であるためあまり気にする必要はない。
なお、perperではサーバーを停止するコマンドはvanillaと同様にstopである

手順３
手順１、２の内容を設置するサーバー各々に繰り返し実行する。


構成例
ロビー鯖、サバイバル鯖、資源サバ、建築鯖、テスト鯖

手順４（ProxyServerの設置）
新規フォルダを作成し、velocity-*.jarをこのフォルダに移動。
以下のコマンドをpaper-*.jarがあるディレクトリで実行。
java -jar velocity-*.jar nogui

手順５（velocity.tomlの編集）
ーーProxyServerの設定ーー
ポートアドレスの設定
bindを以下のように設定する。
bind = "port-address"
このポートアドレスに接続することで鯖に入れるようになる。
なお、この後設定する各鯖のポートアドレスとは異なるものにしておくこと。

設定例
bind = 192.168.****.****:25565

player-info-forwarding-modeの設定
player-info-forwarding-mode = noneではofflineのuuidが適用されてしまう。
この場合プレイヤーのテクスチャがオフラインもテクスチャ（デフォルトのテクスチャ）になってしまう。

このため、今回はplayer-info-forwarding-mode = modernに設定する。

ーー接続鯖の設定ーー
[servers]の項目を以下のように設定する。
server-name1 = "port-address1"
server-name2 = "port-address2"
...

try = [
	server-name1
]

設置した鯖各々を設定する。tryで設定する鯖の名前は最初にログインをする鯖の名前である。

設定例
lobby = 192.168.****.****:25566
servival = 192.168.****.****:25567
resource = 192.168.****.****:25567

try = [
	lobby
]


[forced-hosts]の項目を以下のように設定する。
"server-name.example.com" = [
    "server-name"
]
設置した鯖各々を設定する。

設定例
"lobby.example.com" = [
    "lobby"
]
"survival.example.com" = [
    "survival"
]
"resource.example.com" = [
    "resource"
]

手順6（各鯖のproxies設定）
手順１、２で設定した鯖のディレクトリにに戻り./config/paper-global.ymlの設定をする。
proxiesの項目を以下のように設定する

proxies:
  bungee-cord:
    online-mode: false
  proxy-protocol: false
  velocity:
    enabled: true
    online-mode: true
    secret: ****

ここでsecretの値を****と表現してあるが、これはvelocityのディレクトリにあるforwarding.secretファイルにある値を設定する。

以上で設定は終了である。ここまでの手順ではプラグインなどによるインベントリ同期、ポータル設定などは含まれていない。
拙鯖（造語、こんな言葉はないはず）ではportalにはAdvance Portalをプラグインとして導入している。これについては他に詳しく解説しているサイトがあるので参照されたい。
インベントリ同期に関しては、この機能を提供するプラグインが有料であったり、サイトが乗っ取りを受けて移転していたりなど不安な要素があったため、自作している。（かいせつするかも～）

コマンド
\server server-name　：ワールドを移動





